<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teras Kaca Cafe - Dashboard Pelanggan</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* User Dashboard Styles - VERSI LENGKAP */
        .user-dashboard {
            padding-top: 80px;
            min-height: 100vh;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }
        
        .user-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 20px 0;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .user-header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-avatar {
            width: 60px;
            height: 60px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-color);
            font-size: 1.8rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        
        .user-welcome h2 {
            color: white;
            margin-bottom: 5px;
        }
        
        .user-welcome p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.95rem;
        }
        
        .user-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 40px;
        }
        
        .user-stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: var(--shadow-light);
            display: flex;
            align-items: center;
            gap: 20px;
            transition: var(--transition);
            cursor: pointer;
        }
        
        .user-stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-heavy);
        }
        
        .user-stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: white;
        }
        
        .stat-1 .user-stat-icon { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .stat-2 .user-stat-icon { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .stat-3 .user-stat-icon { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .stat-4 .user-stat-icon { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
        
        .user-stat-info h3 {
            font-size: 1.8rem;
            margin-bottom: 5px;
            color: var(--dark-color);
        }
        
        .user-stat-info p {
            color: var(--text-light);
            font-size: 0.9rem;
        }
        
        .user-main {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 30px;
        }
        
        @media (max-width: 992px) {
            .user-main {
                grid-template-columns: 1fr;
            }
        }
        
        /* User Sidebar */
        .user-sidebar {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow-light);
            height: fit-content;
            position: sticky;
            top: 100px;
        }
        
        .user-profile {
            text-align: center;
            padding-bottom: 20px;
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .user-profile-avatar {
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2.5rem;
            margin: 0 auto 15px;
            border: 4px solid white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .user-profile h3 {
            margin-bottom: 5px;
            color: var(--dark-color);
        }
        
        .user-profile p {
            color: var(--text-light);
            font-size: 0.9rem;
            margin-bottom: 10px;
        }
        
        .user-member-badge {
            display: inline-block;
            padding: 5px 15px;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #333;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .user-nav {
            list-style: none;
            margin-bottom: 25px;
        }
        
        .user-nav li {
            margin-bottom: 10px;
        }
        
        .user-nav a {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 15px;
            text-decoration: none;
            color: var(--dark-color);
            border-radius: 10px;
            transition: var(--transition);
        }
        
        .user-nav a:hover, .user-nav a.active {
            background: rgba(26, 83, 92, 0.1);
            color: var(--primary-color);
        }
        
        .user-nav i {
            width: 20px;
            text-align: center;
        }
        
        .user-sidebar-footer {
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        .logout-btn {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 25px;
            background: var(--accent-color);
            color: white;
            border: none;
            border-radius: 30px;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            width: 100%;
            justify-content: center;
        }
        
        .logout-btn:hover {
            background: #ff5252;
            transform: translateY(-2px);
        }
        
        /* User Content */
        .user-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: var(--shadow-light);
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .tab-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        /* Menu Tab */
        .menu-filters {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        .menu-filter-btn {
            padding: 10px 20px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 50px;
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .menu-filter-btn:hover, .menu-filter-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .menu-search {
            position: relative;
            margin-bottom: 25px;
        }
        
        .menu-search input {
            width: 100%;
            padding: 15px 20px 15px 50px;
            border-radius: 50px;
            border: 1px solid #ddd;
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
        }
        
        .menu-search i {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary-color);
        }
        
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .user-menu-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: var(--shadow-light);
            transition: var(--transition);
            position: relative;
            border: 1px solid #eee;
        }
        
        .user-menu-card:hover {
            transform: translateY(-10px);
            box-shadow: var(--shadow-heavy);
            border-color: var(--secondary-color);
        }
        
        .user-menu-img {
            height: 180px;
            overflow: hidden;
            position: relative;
        }
        
        .user-menu-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: var(--transition);
        }
        
        .user-menu-card:hover .user-menu-img img {
            transform: scale(1.05);
        }
        
        .menu-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 5px 15px;
            border-radius: 30px;
            font-size: 0.8rem;
            font-weight: 600;
            z-index: 2;
        }
        
        .badge-popular {
            background: var(--accent-color);
            color: white;
        }
        
        .badge-new {
            background: var(--primary-color);
            color: white;
        }
        
        .badge-promo {
            background: #4CAF50;
            color: white;
        }
        
        .user-menu-info {
            padding: 20px;
        }
        
        .user-menu-info h3 {
            margin-bottom: 10px;
            font-size: 1.2rem;
        }
        
        .user-menu-info p {
            color: var(--text-light);
            font-size: 0.9rem;
            margin-bottom: 15px;
            line-height: 1.5;
        }
        
        .user-menu-price {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        
        .user-menu-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn-add-cart {
            flex: 1;
            padding: 10px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-add-cart:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
        }
        
        .btn-favorite {
            width: 45px;
            height: 45px;
            background: #f5f5f5;
            color: #666;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn-favorite:hover, .btn-favorite.active {
            background: #ffebee;
            color: #f44336;
        }
        
        /* Cart Tab */
        .cart-container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .cart-items {
            margin-bottom: 30px;
        }
        
        .cart-item {
            display: flex;
            align-items: center;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 12px;
            margin-bottom: 15px;
            gap: 20px;
        }
        
        .cart-item-img {
            width: 100px;
            height: 100px;
            border-radius: 10px;
            overflow: hidden;
            flex-shrink: 0;
        }
        
        .cart-item-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .cart-item-info {
            flex: 1;
        }
        
        .cart-item-info h4 {
            margin-bottom: 10px;
        }
        
        .cart-item-price {
            color: var(--primary-color);
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .cart-item-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 15px;
        }
        
        .quantity-control {
            display: flex;
            align-items: center;
            gap: 10px;
            background: white;
            padding: 5px 15px;
            border-radius: 30px;
            border: 1px solid #ddd;
        }
        
        .quantity-btn {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: var(--primary-color);
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .quantity-input {
            width: 40px;
            text-align: center;
            border: none;
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            font-weight: 600;
        }
        
        .btn-remove {
            background: #ffebee;
            color: #f44336;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn-remove:hover {
            background: #f44336;
            color: white;
        }
        
        .cart-empty {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-light);
        }
        
        .cart-empty i {
            font-size: 4rem;
            color: #e0e0e0;
            margin-bottom: 20px;
        }
        
        .cart-summary {
            background: #f9f9f9;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
        }
        
        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px dashed #ddd;
        }
        
        .summary-row:last-child {
            border-bottom: none;
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--primary-color);
            padding-top: 15px;
            margin-top: 10px;
            border-top: 2px solid #ddd;
        }
        
        .cart-actions {
            display: flex;
            gap: 15px;
        }
        
        .btn-clear-cart {
            padding: 15px 30px;
            background: #f5f5f5;
            color: var(--dark-color);
            border: none;
            border-radius: 10px;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn-clear-cart:hover {
            background: #e0e0e0;
        }
        
        .btn-checkout {
            flex: 1;
            padding: 15px 30px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            border-radius: 10px;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-checkout:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(76, 175, 80, 0.3);
        }
        
        /* Orders Tab */
        .orders-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .order-card-history {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.08);
            border: 1px solid #eee;
            transition: var(--transition);
        }
        
        .order-card-history:hover {
            border-color: var(--secondary-color);
            box-shadow: 0 6px 15px rgba(0,0,0,0.1);
        }
        
        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .order-id {
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .order-date {
            color: var(--text-light);
            font-size: 0.9rem;
        }
        
        .order-status-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 30px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .status-completed {
            background: #d4edda;
            color: #155724;
        }
        
        .status-processing {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .status-cancelled {
            background: #f8d7da;
            color: #721c24;
        }
        
        .order-items-preview {
            margin-bottom: 15px;
        }
        
        .order-item-preview {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px dashed #eee;
        }
        
        .order-total {
            text-align: right;
            font-weight: 600;
            color: var(--primary-color);
            margin-top: 10px;
        }
        
        /* Favorites Tab */
        .favorites-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 25px;
        }
        
        /* Profile Tab */
        .profile-form {
            max-width: 600px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark-color);
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            transition: var(--transition);
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(26, 83, 92, 0.1);
        }
        
        /* Cart Floating Button */
        .cart-floating-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--primary-color);
            color: white;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: 0 6px 20px rgba(26, 83, 92, 0.4);
            z-index: 999;
            transition: var(--transition);
            border: none;
            cursor: pointer;
            text-decoration: none;
        }
        
        .cart-floating-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(26, 83, 92, 0.6);
        }
        
        .cart-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--accent-color);
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        /* Notification */
        .notification {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--primary-color);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            transition: transform 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 400px;
        }
        
        .notification.show {
            transform: translateX(-50%) translateY(0);
        }
        
        .notification.success {
            background: #4CAF50;
        }
        
        .notification.error {
            background: #f44336;
        }
        
        .notification.info {
            background: #2196F3;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .user-header-content {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .user-stats {
                grid-template-columns: 1fr;
            }
            
            .menu-grid, .favorites-grid {
                grid-template-columns: 1fr;
            }
            
            .cart-item {
                flex-direction: column;
                text-align: center;
            }
            
            .cart-item-controls {
                justify-content: center;
            }
            
            .cart-actions {
                flex-direction: column;
            }
        }
        
        @media (max-width: 480px) {
            .user-sidebar, .user-content {
                padding: 20px;
            }
            
            .tab-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .menu-filters {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- User Dashboard -->
    <div class="user-dashboard">
        <!-- User Header -->
        <div class="user-header">
            <div class="container">
                <div class="user-header-content">
                    <div class="user-info">
                        <div class="user-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="user-welcome">
                            <h2>Selamat Datang, <span id="userName">Pelanggan</span>!</h2>
                            <p><i class="far fa-clock"></i> <span id="currentTime">00:00</span> | Poin Anda: <strong id="userPoints">0</strong> points</p>
                        </div>
                    </div>
                    <div class="user-actions">
                        <a href="index.html" class="btn-secondary" style="color: white; border-color: white;">
                            <i class="fas fa-home"></i> Home
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="container">
            <!-- User Stats -->
            <div class="user-stats">
                <div class="user-stat-card stat-1">
                    <div class="user-stat-icon">
                        <i class="fas fa-shopping-cart"></i>
                    </div>
                    <div class="user-stat-info">
                        <h3 id="totalOrders">0</h3>
                        <p>Total Pesanan</p>
                    </div>
                </div>
                <div class="user-stat-card stat-2">
                    <div class="user-stat-icon">
                        <i class="fas fa-star"></i>
                    </div>
                    <div class="user-stat-info">
                        <h3 id="totalPoints">0</h3>
                        <p>Poin Reward</p>
                    </div>
                </div>
                <div class="user-stat-card stat-3">
                    <div class="user-stat-icon">
                        <i class="fas fa-heart"></i>
                    </div>
                    <div class="user-stat-info">
                        <h3 id="totalFavorites">0</h3>
                        <p>Menu Favorit</p>
                    </div>
                </div>
                <div class="user-stat-card stat-4">
                    <div class="user-stat-icon">
                        <i class="fas fa-coffee"></i>
                    </div>
                    <div class="user-stat-info">
                        <h3 id="totalVisits">0</h3>
                        <p>Kunjungan</p>
                    </div>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="user-main">
                <!-- Sidebar -->
                <div class="user-sidebar">
                    <div class="user-profile">
                        <div class="user-profile-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <h3 id="profileName">Nama Pelanggan</h3>
                        <p id="profileEmail">email@example.com</p>
                        <span class="user-member-badge">
                            <i class="fas fa-crown"></i> Member Silver
                        </span>
                    </div>
                    
                    <ul class="user-nav">
                        <li><a href="#" class="active" data-tab="menu"><i class="fas fa-utensils"></i> Menu & Pesan</a></li>
                        <li><a href="#" data-tab="cart"><i class="fas fa-shopping-cart"></i> Keranjang (<span id="cartCountSidebar">0</span>)</a></li>
                        <li><a href="#" data-tab="orders"><i class="fas fa-history"></i> Riwayat Pesanan</a></li>
                        <li><a href="#" data-tab="favorites"><i class="fas fa-heart"></i> Favorit Saya</a></li>
                        <li><a href="#" data-tab="profile"><i class="fas fa-user-cog"></i> Profil Saya</a></li>
                        <li><a href="#" data-tab="reservation"><i class="fas fa-calendar-alt"></i> Reservasi Meja</a></li>
                    </ul>
                    
                    <div class="user-sidebar-footer">
                        <button class="logout-btn" onclick="logout()">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </div>
                
                <!-- Content -->
                <div class="user-content">
                    <!-- Menu Tab -->
                    <div class="tab-content active" id="menu-tab">
                        <div class="tab-header">
                            <h3>Menu Teras Kaca Cafe</h3>
                            <div class="menu-search">
                                <i class="fas fa-search"></i>
                                <input type="text" id="menuSearch" placeholder="Cari menu favorit Anda...">
                            </div>
                        </div>
                        
                        <div class="menu-filters">
                            <button class="menu-filter-btn active" data-filter="all">Semua Menu</button>
                            <button class="menu-filter-btn" data-filter="minuman">Minuman</button>
                            <button class="menu-filter-btn" data-filter="makanan">Makanan</button>
                            <button class="menu-filter-btn" data-filter="snack">Snack & Dessert</button>
                            <button class="menu-filter-btn" data-filter="spesial">Spesial</button>
                        </div>
                        
                        <div class="menu-grid" id="menuGrid">
                            <!-- Menu items will be loaded dynamically -->
                        </div>
                        
                        <div class="empty-state" id="menuEmpty" style="display: none;">
                            <i class="fas fa-utensils"></i>
                            <h3>Menu Tidak Ditemukan</h3>
                            <p>Coba kata kunci lain atau filter berbeda</p>
                        </div>
                    </div>
                    
                    <!-- Cart Tab -->
                    <div class="tab-content" id="cart-tab">
                        <div class="tab-header">
                            <h3>Keranjang Belanja</h3>
                            <span id="cartTotalItems">0 item</span>
                        </div>
                        
                        <div class="cart-container">
                            <div class="cart-items" id="cartItems">
                                <!-- Cart items will be loaded here -->
                            </div>
                            
                            <div class="cart-empty" id="cartEmpty">
                                <i class="fas fa-shopping-cart"></i>
                                <h3>Keranjang Kosong</h3>
                                <p>Tambahkan menu favorit Anda ke keranjang</p>
                                <a href="#" class="btn-primary" style="margin-top: 20px;" onclick="switchToMenuTab()">
                                    <i class="fas fa-utensils"></i> Lihat Menu
                                </a>
                            </div>
                            
                            <div class="cart-summary" id="cartSummary" style="display: none;">
                                <div class="summary-row">
                                    <span>Subtotal:</span>
                                    <span id="cartSubtotal">Rp 0</span>
                                </div>
                                <div class="summary-row">
                                    <span>Pajak (10%):</span>
                                    <span id="cartTax">Rp 0</span>
                                </div>
                                <div class="summary-row">
                                    <span>Layanan (5%):</span>
                                    <span id="cartService">Rp 0</span>
                                </div>
                                <div class="summary-row">
                                    <span>Total:</span>
                                    <span id="cartTotal">Rp 0</span>
                                </div>
                            </div>
                            
                            <div class="cart-actions" id="cartActions" style="display: none;">
                                <button class="btn-clear-cart" onclick="clearCart()">
                                    <i class="fas fa-trash"></i> Kosongkan Keranjang
                                </button>
                                <button class="btn-checkout" onclick="checkout()">
                                    <i class="fab fa-whatsapp"></i> Checkout via WhatsApp
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Orders Tab -->
                    <div class="tab-content" id="orders-tab">
                        <div class="tab-header">
                            <h3>Riwayat Pesanan</h3>
                            <div>
                                <select class="form-control" id="orderFilter" style="width: auto;">
                                    <option value="all">Semua</option>
                                    <option value="completed">Selesai</option>
                                    <option value="processing">Diproses</option>
                                    <option value="cancelled">Dibatalkan</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="orders-list" id="ordersList">
                            <!-- Orders will be loaded here -->
                        </div>
                        
                        <div class="empty-state" id="ordersEmpty">
                            <i class="fas fa-history"></i>
                            <h3>Belum Ada Pesanan</h3>
                            <p>Pesanan Anda akan muncul di sini</p>
                        </div>
                    </div>
                    
                    <!-- Favorites Tab -->
                    <div class="tab-content" id="favorites-tab">
                        <div class="tab-header">
                            <h3>Menu Favorit Saya</h3>
                            <span id="favoritesCount">0 menu</span>
                        </div>
                        
                        <div class="favorites-grid" id="favoritesGrid">
                            <!-- Favorite menu items will be loaded here -->
                        </div>
                        
                        <div class="empty-state" id="favoritesEmpty">
                            <i class="fas fa-heart"></i>
                            <h3>Belum Ada Favorit</h3>
                            <p>Klik ikon hati pada menu untuk menambahkannya ke favorit</p>
                        </div>
                    </div>
                    
                    <!-- Profile Tab -->
                    <div class="tab-content" id="profile-tab">
                        <div class="tab-header">
                            <h3>Profil Saya</h3>
                            <button class="btn-primary" onclick="updateProfile()">
                                <i class="fas fa-save"></i> Simpan Perubahan
                            </button>
                        </div>
                        
                        <div class="profile-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Nama Lengkap</label>
                                    <input type="text" id="profileNameInput" class="form-control" value="Nama Pelanggan">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Email</label>
                                    <input type="email" id="profileEmailInput" class="form-control" value="email@example.com">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Telepon</label>
                                    <input type="tel" id="profilePhoneInput" class="form-control" value="081234567890">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Tanggal Lahir</label>
                                    <input type="date" id="profileBirthDate" class="form-control" value="1990-01-01">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Alamat</label>
                                <textarea id="profileAddress" class="form-control" rows="3">Jl. Contoh No. 123, Jakarta</textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Ganti Password</label>
                                <input type="password" id="profileNewPassword" class="form-control" placeholder="Masukkan password baru">
                                <small style="color: var(--text-light);">Kosongkan jika tidak ingin mengubah password</small>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Konfirmasi Password</label>
                                <input type="password" id="profileConfirmPassword" class="form-control" placeholder="Konfirmasi password baru">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Reservation Tab -->
                    <div class="tab-content" id="reservation-tab">
                        <div class="tab-header">
                            <h3>Reservasi Meja</h3>
                            <button class="btn-primary" onclick="makeReservation()">
                                <i class="fas fa-calendar-check"></i> Buat Reservasi
                            </button>
                        </div>
                        
                        <div class="profile-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Tanggal Reservasi</label>
                                    <input type="date" id="reservationDate" class="form-control" min="<?php echo date('Y-m-d'); ?>">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Waktu</label>
                                    <input type="time" id="reservationTime" class="form-control" value="18:00">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Jumlah Orang</label>
                                    <select id="reservationPeople" class="form-control">
                                        <option value="2">2 Orang</option>
                                        <option value="4">4 Orang</option>
                                        <option value="6">6 Orang</option>
                                        <option value="8">8 Orang</option>
                                        <option value="10">10+ Orang</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Area</label>
                                    <select id="reservationArea" class="form-control">
                                        <option value="indoor">Indoor (AC)</option>
                                        <option value="outdoor">Outdoor (Teras Kaca)</option>
                                        <option value="vip">VIP Room</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Kebutuhan Khusus</label>
                                <textarea id="reservationNotes" class="form-control" rows="3" placeholder="Contoh: Meja dekat jendela, ada anak kecil, perayaan ulang tahun..."></textarea>
                            </div>
                            
                            <div style="background: #f9f9f9; padding: 20px; border-radius: 10px; margin-top: 30px;">
                                <h4>Informasi Reservasi</h4>
                                <ul style="color: var(--text-light); margin: 10px 0 0 20px;">
                                    <li>Reservasi dapat dilakukan maksimal H-1</li>
                                    <li>Konfirmasi akan dikirim via WhatsApp 2 jam sebelum waktu reservasi</li>
                                    <li>Toleransi keterlambatan: 15 menit</li>
                                    <li>Pembatalan minimal 3 jam sebelum waktu reservasi</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Cart Floating Button -->
        <a href="#" class="cart-floating-btn" onclick="switchToCartTab()">
            <i class="fas fa-shopping-cart"></i>
            <span class="cart-count" id="cartCountFloat">0</span>
        </a>
        
        <!-- Notification -->
        <div class="notification" id="notification">
            <i class="fas fa-check-circle"></i>
            <span id="notificationText">Item ditambahkan ke keranjang!</span>
        </div>
    </div>

    <script src="script.js"></script>
<script>
    // User Dashboard Functionality - VERSI PERBAIKAN
    document.addEventListener('DOMContentLoaded', function() {
        console.log('User dashboard loading...');
        
        // Check authentication
        const currentUser = window.TerasKaca ? window.TerasKaca.getCurrentUser() : null;
        if (!currentUser) {
            console.log('No user logged in, redirecting to login');
            window.location.href = 'login.html';
            return;
        }
        
        console.log('Current user:', currentUser);
        
        // Initialize
        initializeDashboard();
    });
    
    function initializeDashboard() {
        try {
            const currentUser = window.TerasKaca.getCurrentUser();
            
            // Set user info FIXED VERSION
            document.querySelectorAll('#userName, #profileName').forEach(el => {
                if (el && currentUser.name) {
                    el.textContent = currentUser.name;
                }
            });
            
            document.querySelectorAll('#profileNameInput').forEach(el => {
                if (el && currentUser.name) {
                    el.value = currentUser.name;
                }
            });
            
            if (currentUser.email) {
                const profileEmail = document.getElementById('profileEmail');
                const profileEmailInput = document.getElementById('profileEmailInput');
                
                if (profileEmail) profileEmail.textContent = currentUser.email;
                if (profileEmailInput) profileEmailInput.value = currentUser.email;
            }
            
            if (currentUser.phone) {
                const phoneInput = document.getElementById('profilePhoneInput');
                if (phoneInput) phoneInput.value = currentUser.phone;
            }
            
            // Initialize real-time clock
            initializeClock();
            
            // Initialize tabs
            initializeTabs();
            
            // Load all data
            loadUserStats();
            loadMenu();
            loadCart();
            loadOrders();
            
            // Initialize notification
            initializeNotification();
            
            // Auto refresh cart count
            setInterval(updateCartCount, 5000);
            
            console.log('Dashboard initialized successfully');
            
        } catch (error) {
            console.error('Error initializing dashboard:', error);
            showNotification('Error loading dashboard: ' + error.message, 'error');
        }
    }
    
    function initializeClock() {
        function updateClock() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('id-ID', {
                hour: '2-digit',
                minute: '2-digit'
            });
            const timeElement = document.getElementById('currentTime');
            if (timeElement) {
                timeElement.textContent = timeString;
            }
        }
        
        updateClock();
        setInterval(updateClock, 1000);
    }
    
    function initializeTabs() {
        const navLinks = document.querySelectorAll('.user-nav a');
        const tabContents = document.querySelectorAll('.tab-content');
        
        navLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Remove active class from all links
                navLinks.forEach(item => item.classList.remove('active'));
                
                // Add active class to clicked link
                this.classList.add('active');
                
                // Hide all tab contents
                tabContents.forEach(content => content.classList.remove('active'));
                
                // Show selected tab content
                const tabId = this.getAttribute('data-tab') + '-tab';
                const tabElement = document.getElementById(tabId);
                if (tabElement) {
                    tabElement.classList.add('active');
                }
                
                // Load data for active tab
                switch(this.getAttribute('data-tab')) {
                    case 'cart':
                        loadCart();
                        break;
                    case 'orders':
                        loadOrders();
                        break;
                    case 'favorites':
                        loadFavorites();
                        break;
                }
            });
        });
        
        // Menu filters
        const filterButtons = document.querySelectorAll('.menu-filter-btn');
        filterButtons.forEach(btn => {
            btn.addEventListener('click', function() {
                filterButtons.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                const filter = this.getAttribute('data-filter');
                filterMenu(filter);
            });
        });
        
        // Menu search
        const searchInput = document.getElementById('menuSearch');
        if (searchInput) {
            let searchTimeout;
            searchInput.addEventListener('input', function() {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    searchMenu(this.value);
                }, 300);
            });
        }
        
        // Order filter
        const orderFilter = document.getElementById('orderFilter');
        if (orderFilter) {
            orderFilter.addEventListener('change', function() {
                loadOrders();
            });
        }
    }
    
    function loadUserStats() {
        try {
            const currentUser = window.TerasKaca.getCurrentUser();
            const userOrders = window.TerasKaca.getUserOrders(currentUser.name);
            
            // Calculate stats
            const totalOrders = userOrders.length;
            const completedOrders = userOrders.filter(o => o.status === 'completed').length;
            
            // Calculate points
            let totalSpent = 0;
            userOrders.forEach(order => {
                if (order.status === 'completed') {
                    totalSpent += order.total || 0;
                }
            });
            
            const totalPoints = Math.floor(totalSpent / 10000);
            const totalFavorites = 0; // Would come from user data
            const totalVisits = completedOrders;
            
            // Update stats
            updateElementText('totalOrders', totalOrders);
            updateElementText('totalPoints', totalPoints);
            updateElementText('userPoints', totalPoints);
            updateElementText('totalFavorites', totalFavorites);
            updateElementText('totalVisits', totalVisits);
            
            // Update member level
            let memberLevel = 'Silver';
            if (totalPoints >= 100) memberLevel = 'Gold';
            if (totalPoints >= 500) memberLevel = 'Platinum';
            
            const badge = document.querySelector('.user-member-badge');
            if (badge) {
                badge.innerHTML = `<i class="fas fa-crown"></i> Member ${memberLevel}`;
            }
            
        } catch (error) {
            console.error('Error loading user stats:', error);
        }
    }
    
    function updateElementText(id, value) {
        const element = document.getElementById(id);
        if (element) {
            element.textContent = value;
        }
    }
    
    function loadMenu() {
        try {
            const menus = window.TerasKaca.getAllMenus();
            const menuGrid = document.getElementById('menuGrid');
            
            if (!menuGrid) return;
            
            menuGrid.innerHTML = '';
            
            const activeMenus = menus.filter(menu => menu.isActive !== false);
            
            if (activeMenus.length === 0) {
                menuGrid.innerHTML = '<div class="empty-state"><p>Tidak ada menu tersedia</p></div>';
                return;
            }
            
            activeMenus.forEach(menu => {
                const menuCard = document.createElement('div');
                menuCard.className = 'user-menu-card';
                menuCard.dataset.id = menu.id;
                menuCard.dataset.category = menu.category;
                menuCard.dataset.name = menu.name.toLowerCase();
                
                // Determine badge
                let badge = '';
                if (menu.stock < 5) {
                    badge = `<span class="menu-badge badge-popular">Hampir Habis</span>`;
                } else if (menu.category === 'spesial') {
                    badge = `<span class="menu-badge badge-new">Spesial</span>`;
                } else if (menu.category === 'minuman') {
                    badge = `<span class="menu-badge badge-promo">Minuman</span>`;
                }
                
                menuCard.innerHTML = `
                    <div class="user-menu-img">
                        ${badge}
                        <img src="${menu.image || 'https://images.unsplash.com/photo-1514432324607-a09d9b4aefdd?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=764&q=80'}" alt="${menu.name}" onerror="this.src='https://images.unsplash.com/photo-1514432324607-a09d9b4aefdd?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=764&q=80'">
                    </div>
                    <div class="user-menu-info">
                        <h3>${menu.name}</h3>
                        <p>${menu.description || 'Menu spesial dari Teras Kaca Cafe'}</p>
                        <div class="user-menu-price">${window.TerasKaca.formatCurrency(menu.price)}</div>
                        <div class="user-menu-actions">
                            <button class="btn-add-cart" onclick="addToCart('${menu.id}')" ${menu.stock <= 0 ? 'disabled style="opacity:0.5;"' : ''}>
                                <i class="fas fa-cart-plus"></i> ${menu.stock <= 0 ? 'Habis' : 'Tambah'}
                            </button>
                            <button class="btn-favorite" onclick="toggleFavorite('${menu.id}')">
                                <i class="far fa-heart"></i>
                            </button>
                        </div>
                    </div>
                `;
                
                menuGrid.appendChild(menuCard);
            });
            
        } catch (error) {
            console.error('Error loading menu:', error);
            showNotification('Error loading menu: ' + error.message, 'error');
        }
    }
    
    function filterMenu(category) {
        const menuCards = document.querySelectorAll('.user-menu-card');
        let visibleCount = 0;
        
        menuCards.forEach(card => {
            if (category === 'all' || card.dataset.category === category) {
                card.style.display = 'block';
                visibleCount++;
            } else {
                card.style.display = 'none';
            }
        });
        
        // Show/hide empty state
        const emptyState = document.getElementById('menuEmpty');
        if (visibleCount === 0) {
            if (emptyState) {
                emptyState.style.display = 'block';
            }
        } else {
            if (emptyState) {
                emptyState.style.display = 'none';
            }
        }
    }
    
    function searchMenu(query) {
        const menuCards = document.querySelectorAll('.user-menu-card');
        const searchTerm = query.toLowerCase().trim();
        let visibleCount = 0;
        
        menuCards.forEach(card => {
            const menuName = card.dataset.name;
            
            if (!searchTerm || menuName.includes(searchTerm)) {
                card.style.display = 'block';
                visibleCount++;
            } else {
                card.style.display = 'none';
            }
        });
        
        // Show/hide empty state
        const emptyState = document.getElementById('menuEmpty');
        if (emptyState) {
            if (visibleCount === 0) {
                emptyState.innerHTML = `
                    <i class="fas fa-search"></i>
                    <h3>Tidak Ditemukan</h3>
                    <p>Tidak ada menu yang cocok dengan "${query}"</p>
                `;
                emptyState.style.display = 'block';
            } else {
                emptyState.style.display = 'none';
            }
        }
    }
    
    // FIXED: Function to add item to cart
    function addToCart(menuId) {
        try {
            console.log('Adding to cart:', menuId);
            
            if (!window.TerasKaca) {
                throw new Error('Sistem tidak tersedia');
            }
            
            const menu = window.TerasKaca.getMenuById(menuId);
            if (!menu) {
                throw new Error('Menu tidak ditemukan');
            }
            
            if (menu.stock <= 0) {
                showNotification(`${menu.name} stok habis!`, 'error');
                return;
            }
            
            // Add to cart
            const cart = window.TerasKaca.addToCart(menuId, 1);
            console.log('Cart after add:', cart);
            
            // Update cart display
            updateCartCount();
            
            // Show success notification
            showNotification(`${menu.name} ditambahkan ke keranjang! `, 'success');
            
            // If on cart tab, refresh cart
            const cartTab = document.querySelector('.user-nav a[data-tab="cart"]');
            if (cartTab && cartTab.classList.contains('active')) {
                loadCart();
            }
            
        } catch (error) {
            console.error('Error adding to cart:', error);
            showNotification('Error: ' + error.message, 'error');
        }
    }
    
    function loadCart() {
        try {
            if (!window.TerasKaca) {
                throw new Error('Sistem tidak tersedia');
            }
            
            const cart = window.TerasKaca.getCart();
            const cartItems = document.getElementById('cartItems');
            const cartEmpty = document.getElementById('cartEmpty');
            const cartSummary = document.getElementById('cartSummary');
            const cartActions = document.getElementById('cartActions');
            const cartTotalItems = document.getElementById('cartTotalItems');
            
            if (!cartItems || !cartEmpty || !cartSummary || !cartActions || !cartTotalItems) {
                console.error('Cart elements not found');
                return;
            }
            
            cartItems.innerHTML = '';
            
            if (cart.length === 0) {
                cartEmpty.style.display = 'block';
                cartSummary.style.display = 'none';
                cartActions.style.display = 'none';
                cartTotalItems.textContent = '0 item';
                return;
            }
            
            cartEmpty.style.display = 'none';
            cartSummary.style.display = 'block';
            cartActions.style.display = 'flex';
            cartTotalItems.textContent = `${cart.length} item${cart.length > 1 ? 's' : ''}`;
            
            // Calculate totals
            let subtotal = 0;
            
            cart.forEach(item => {
                const menu = window.TerasKaca.getMenuById(item.menuId);
                if (!menu) return;
                
                const itemTotal = item.price * item.quantity;
                subtotal += itemTotal;
                
                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item';
                cartItem.innerHTML = `
                    <div class="cart-item-img">
                        <img src="${menu.image || 'https://images.unsplash.com/photo-1514432324607-a09d9b4aefdd?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=764&q=80'}" alt="${item.name}">
                    </div>
                    <div class="cart-item-info">
                        <h4>${item.name}</h4>
                        <div class="cart-item-price">${window.TerasKaca.formatCurrency(item.price)}</div>
                        <div class="cart-item-controls">
                            <div class="quantity-control">
                                <button class="quantity-btn" onclick="updateCartQuantity('${item.menuId}', ${item.quantity - 1})">-</button>
                                <input type="text" class="quantity-input" value="${item.quantity}" readonly>
                                <button class="quantity-btn" onclick="updateCartQuantity('${item.menuId}', ${item.quantity + 1})">+</button>
                            </div>
                            <button class="btn-remove" onclick="removeFromCart('${item.menuId}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
                cartItems.appendChild(cartItem);
            });
            
            // Calculate tax and service charge
            const settings = window.TerasKaca.getSettings();
            const taxRate = settings.taxRate || 10;
            const serviceRate = settings.serviceChargeRate || 5;
            
            const tax = subtotal * (taxRate / 100);
            const service = subtotal * (serviceRate / 100);
            const total = subtotal + tax + service;
            
            // Update summary
            document.getElementById('cartSubtotal').textContent = window.TerasKaca.formatCurrency(subtotal);
            document.getElementById('cartTax').textContent = window.TerasKaca.formatCurrency(tax);
            document.getElementById('cartService').textContent = window.TerasKaca.formatCurrency(service);
            document.getElementById('cartTotal').textContent = window.TerasKaca.formatCurrency(total);
            
        } catch (error) {
            console.error('Error loading cart:', error);
            showNotification('Error loading cart: ' + error.message, 'error');
        }
    }
    
    function updateCartQuantity(menuId, newQuantity) {
        try {
            if (newQuantity < 1) {
                removeFromCart(menuId);
                return;
            }
            
            const menu = window.TerasKaca.getMenuById(menuId);
            if (newQuantity > menu.stock) {
                showNotification(`Stok tersedia: ${menu.stock}`, 'error');
                return;
            }
            
            window.TerasKaca.updateCartItem(menuId, newQuantity);
            loadCart();
            updateCartCount();
            
        } catch (error) {
            showNotification('Error: ' + error.message, 'error');
        }
    }
    
    function removeFromCart(menuId) {
        if (confirm('Hapus item dari keranjang?')) {
            window.TerasKaca.removeFromCart(menuId);
            loadCart();
            updateCartCount();
            showNotification('Item dihapus dari keranjang', 'success');
        }
    }
    
    function clearCart() {
        if (confirm('Kosongkan seluruh keranjang?')) {
            window.TerasKaca.clearCart();
            loadCart();
            updateCartCount();
            showNotification('Keranjang dikosongkan', 'success');
        }
    }
    
    function updateCartCount() {
        try {
            if (!window.TerasKaca) return;
            
            const cart = window.TerasKaca.getCart();
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            
            // Update all cart count displays
            const sidebarCount = document.getElementById('cartCountSidebar');
            const floatCount = document.getElementById('cartCountFloat');
            
            if (sidebarCount) sidebarCount.textContent = totalItems;
            if (floatCount) floatCount.textContent = totalItems;
            
            // Show/hide floating button
            const floatBtn = document.querySelector('.cart-floating-btn');
            if (floatBtn) {
                if (totalItems > 0) {
                    floatBtn.style.display = 'flex';
                } else {
                    floatBtn.style.display = 'none';
                }
            }
            
        } catch (error) {
            console.error('Error updating cart count:', error);
        }
    }
    
    // FIXED: Checkout function
    function checkout() {
        try {
            console.log('Starting checkout process...');
            
            if (!window.TerasKaca) {
                throw new Error('Sistem tidak tersedia');
            }
            
            const cart = window.TerasKaca.getCart();
            if (cart.length === 0) {
                showNotification('Keranjang kosong! Tambahkan item terlebih dahulu.', 'error');
                return;
            }
            
            const currentUser = window.TerasKaca.getCurrentUser();
            const settings = window.TerasKaca.getSettings();
            
            if (!currentUser) {
                throw new Error('Silakan login terlebih dahulu');
            }
            
            // Calculate totals
            let subtotal = 0;
            let itemsText = '';
            
            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                subtotal += itemTotal;
                itemsText += ` ${item.name} (${item.quantity}x) - ${window.TerasKaca.formatCurrency(itemTotal)}\n`;
            });
            
            const tax = subtotal * ((settings.taxRate || 10) / 100);
            const service = subtotal * ((settings.serviceChargeRate || 5) / 100);
            const total = subtotal + tax + service;
            
            // Create order
            const orderData = {
                customerName: currentUser.name || 'Pelanggan',
                customerPhone: currentUser.phone || '081234567890',
                orderType: 'takeaway',
                items: cart.map(item => ({
                    menuId: item.menuId,
                    name: item.name,
                    price: item.price,
                    quantity: item.quantity
                })),
                subtotal: subtotal,
                tax: tax,
                serviceCharge: service,
                total: total,
                status: 'waiting',
                paymentMethod: 'transfer',
                paymentStatus: 'pending',
                orderDate: new Date().toISOString()
            };
            
            const order = window.TerasKaca.saveOrder(orderData);
            console.log('Order created:', order);
            
            // Prepare WhatsApp message
            const message = `Halo ${settings.cafeName || 'Teras Kaca Cafe'}! Saya ingin memesan:\n\n` +
                           ` *DETAIL PESANAN*\n` +
                           `ID: ${order.id}\n` +
                           `Nama: ${order.customerName}\n` +
                           `Telepon: ${order.customerPhone}\n` +
                           `Tipe: Bawa Pulang\n\n` +
                           ` *ITEM PESANAN*\n` +
                           itemsText + '\n' +
                           ` *RINCIAN*\n` +
                           `Subtotal: ${window.TerasKaca.formatCurrency(subtotal)}\n` +
                           `Pajak (${settings.taxRate || 10}%): ${window.TerasKaca.formatCurrency(tax)}\n` +
                           `Layanan (${settings.serviceChargeRate || 5}%): ${window.TerasKaca.formatCurrency(service)}\n` +
                           `*TOTAL: ${window.TerasKaca.formatCurrency(total)}*\n\n` +
                           ` *PEMBAYARAN*\n` +
                           `Metode: Transfer Bank\n\n` +
                           ` *KONFIRMASI*\n` +
                           `Mohon konfirmasi ketersediaan dan total pembayaran.\n` +
                           `Terima kasih!`;
            
            const encodedMessage = encodeURIComponent(message);
            const whatsappNumber = settings.whatsapp || '6281234567890';
            const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${encodedMessage}`;
            
            // Clear cart
            window.TerasKaca.clearCart();
            updateCartCount();
            
            // Show confirmation
            if (confirm(`Pesanan berhasil dibuat!\n\nID: ${order.id}\nTotal: ${window.TerasKaca.formatCurrency(total)}\n\nBuka WhatsApp untuk konfirmasi?`)) {
                window.open(whatsappUrl, '_blank');
            }
            
            // Redirect to orders tab
            switchToOrdersTab();
            showNotification('Pesanan berhasil dibuat! ', 'success');
            
        } catch (error) {
            console.error('Error during checkout:', error);
            showNotification('Error: ' + error.message, 'error');
        }
    }
    
    function loadOrders() {
        try {
            const currentUser = window.TerasKaca.getCurrentUser();
            const filter = document.getElementById('orderFilter')?.value || 'all';
            
            const userOrders = window.TerasKaca.getAllOrders().filter(order => 
                (order.customerName === currentUser.name || 
                 order.customerPhone === currentUser.phone) &&
                (filter === 'all' || order.status === filter)
            ).sort((a, b) => new Date(b.orderDate) - new Date(a.orderDate));
            
            const ordersList = document.getElementById('ordersList');
            const ordersEmpty = document.getElementById('ordersEmpty');
            
            if (!ordersList || !ordersEmpty) return;
            
            ordersList.innerHTML = '';
            
            if (userOrders.length === 0) {
                ordersEmpty.style.display = 'block';
                return;
            }
            
            ordersEmpty.style.display = 'none';
            
            userOrders.forEach(order => {
                const orderCard = document.createElement('div');
                orderCard.className = 'order-card-history';
                
                const orderDate = new Date(order.orderDate);
                const dateString = orderDate.toLocaleDateString('id-ID', {
                    day: 'numeric',
                    month: 'short',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                // Status badge
                let statusBadge = '';
                let statusText = '';
                let statusColor = '';
                
                switch(order.status) {
                    case 'completed':
                        statusBadge = 'status-completed';
                        statusText = 'Selesai';
                        statusColor = '#4CAF50';
                        break;
                    case 'processing':
                        statusBadge = 'status-processing';
                        statusText = 'Diproses';
                        statusColor = '#2196F3';
                        break;
                    case 'ready':
                        statusBadge = 'status-processing';
                        statusText = 'Siap';
                        statusColor = '#FF9800';
                        break;
                    case 'cancelled':
                        statusBadge = 'status-cancelled';
                        statusText = 'Dibatalkan';
                        statusColor = '#f44336';
                        break;
                    default:
                        statusBadge = 'status-processing';
                        statusText = 'Menunggu';
                        statusColor = '#9E9E9E';
                }
                
                // Items preview
                let itemsPreview = '';
                order.items.slice(0, 3).forEach(item => {
                    itemsPreview += `<div class="order-item-preview">
                        <span>${item.name} (${item.quantity}x)</span>
                        <span>${window.TerasKaca.formatCurrency(item.price * item.quantity)}</span>
                    </div>`;
                });
                
                if (order.items.length > 3) {
                    itemsPreview += `<div class="order-item-preview" style="color: var(--text-light); font-style: italic;">
                        +${order.items.length - 3} item lainnya
                    </div>`;
                }
                
                orderCard.innerHTML = `
                    <div class="order-header">
                        <div>
                            <div class="order-id">${order.id}</div>
                            <div class="order-date">${dateString}</div>
                        </div>
                        <span class="order-status-badge ${statusBadge}" style="background: ${statusColor}20; color: ${statusColor}; border: 1px solid ${statusColor}40;">
                            ${statusText}
                        </span>
                    </div>
                    <div class="order-items-preview">
                        ${itemsPreview}
                    </div>
                    <div class="order-total">
                        Total: ${window.TerasKaca.formatCurrency(order.total)}
                    </div>
                `;
                
                ordersList.appendChild(orderCard);
            });
            
        } catch (error) {
            console.error('Error loading orders:', error);
        }
    }
    
    function loadFavorites() {
        // Simplified for now
        const favoritesCount = 0;
        const favoritesCountElement = document.getElementById('favoritesCount');
        if (favoritesCountElement) {
            favoritesCountElement.textContent = `${favoritesCount} menu`;
        }
    }
    
    function toggleFavorite(menuId) {
        showNotification('Fitur favorit akan segera tersedia!', 'info');
    }
    
    function updateProfile() {
        showNotification('Fitur update profil akan segera tersedia!', 'info');
    }
    
    function makeReservation() {
        showNotification('Fitur reservasi akan segera tersedia!', 'info');
    }
    
    function switchToMenuTab() {
        const menuTab = document.querySelector('.user-nav a[data-tab="menu"]');
        if (menuTab) menuTab.click();
    }
    
    function switchToCartTab() {
        const cartTab = document.querySelector('.user-nav a[data-tab="cart"]');
        if (cartTab) cartTab.click();
    }
    
    function switchToOrdersTab() {
        const ordersTab = document.querySelector('.user-nav a[data-tab="orders"]');
        if (ordersTab) ordersTab.click();
    }
    
    function initializeNotification() {
        const notification = document.getElementById('notification');
        
        window.showNotification = function(message, type = 'success') {
            if (!notification) return;
            
            const icon = type === 'success' ? 'fa-check-circle' : 
                       type === 'error' ? 'fa-exclamation-circle' : 
                       'fa-info-circle';
            
            const textElement = document.getElementById('notificationText');
            if (textElement) {
                textElement.textContent = message;
            }
            
            notification.className = `notification ${type}`;
            const iconElement = notification.querySelector('i');
            if (iconElement) {
                iconElement.className = `fas ${icon}`;
            }
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        };
    }
    
    function logout() {
        if (window.TerasKaca) {
            window.TerasKaca.logoutUser();
        }
        window.location.href = 'login.html';
    }
</script>
</body>
</html>